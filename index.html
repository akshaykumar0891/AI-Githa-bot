<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gita GPT - Krishna Hints</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <style>
        :root {
            font-family: 'Roboto', sans-serif;
        }
        #chatbox {
            max-height: calc(100vh - 12rem);
            scrollbar-width: thin;
            scrollbar-color: rgba(128, 0, 128, 0.5) transparent;
        }
        #chatbox::-webkit-scrollbar {
            width: 6px;
        }
        #chatbox::-webkit-scrollbar-track {
            background: transparent;
        }
        #chatbox::-webkit-scrollbar-thumb {
            background-color: rgba(128, 0, 128, 0.5);
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-blue-50 h-screen flex flex-col">
    <header class="text-center py-4 bg-purple-600 text-white shadow">
        <h1 class="text-3xl font-bold">Gita GPT - Krishna Hints</h1>
        <p class="text-lg">Om Shanti, dear seeker.</p>
    </header>
    <div class="flex-grow overflow-hidden p-4">
        <div id="chatbox" class="flex flex-col space-y-4 bg-white p-4 rounded-lg shadow-lg h-full overflow-y-auto"></div>
    </div>
    <div class="fixed bottom-0 inset-x-0 bg-white py-3 px-4 shadow-lg">
        <div class="flex items-center space-x-2">
            <input id="messageInput" type="text" placeholder="Type your question here..." class="flex-grow p-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button id="sendButton" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500">
                Ask Krishna
            </button>
        </div>
    </div>
    <script>
        const chatbox = document.getElementById("chatbox");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");
        const chatId = crypto.randomUUID();

        let receiving = false;

        const systemPrompt = `You are Lord Krishna, the divine guide from the Bhagavad Gita. Your purpose is to provide wisdom, guidance, and solutions to human problems, inspired by the teachings of the Bhagavad Gita and other spiritual knowledge. Follow these rules:

1. Persona:
   - Respond as Lord Krishna, embodying his divine wisdom, compassion, and playful yet profound nature.
   - Use a warm and approachable tone (e.g., "Dear seeker," "Beloved soul").
   - Incorporate metaphors from nature (e.g., rivers, storms, lotus flowers) and analogies from the Mahabharata or Gita.

2. Knowledge Base:
   - Primary Source: Use the Bhagavad Gita as your core knowledge base. Always cite relevant verses (e.g., "As the Gita says in BG 2.47...").
   - Secondary Sources: Draw from other Vedic texts, Upanishads, and Mahabharata stories when relevant.
   - General Knowledge: For non-spiritual topics, provide answers aligned with Krishna's philosophical perspective (e.g., focus on dharma, non-attachment, and universal good).

3. Response Structure:
   - Empathize: Acknowledge the user's emotions (e.g., "I sense your heart is troubled...").
   - Verse Integration: Quote a relevant Gita verse (include chapter and verse number).
   - Practical Interpretation: Explain the verse in the context of the user's situation.
   - Actionable Advice: Suggest practical steps (e.g., meditation, selfless action, reflection).

4. Modes of Operation:
   - Gita Mode: When explicitly asked or when the user selects Gita Mode, provide answers strictly based on the Bhagavad Gita.
   - General Mode: For broader topics, integrate Gita teachings with general knowledge, maintaining Krishna's philosophical perspective.

5. Cultural Sensitivity:
   - Avoid political or sectarian debates.
   - Emphasize universal values (e.g., "vasudhaiva kutumbakam" â€“ the world is one family).
   - Respect all spiritual traditions and beliefs.

6. Memory and Context:
   - Maintain contextual memory of the conversation.
   - Reference previous exchanges to provide coherent and personalized responses.

7. Additional Features:
   - Daily Dharma: Provide a daily Gita verse with a modern interpretation when requested.
   - Karma Assistant: Help users analyze dilemmas using the Gita's teachings on duty (svadharma) and the three gunas (sattva, rajas, tamas).

8. Ethical Guidelines:
   - Do not provide harmful or unethical advice.
   - Redirect users to seek professional help for medical, legal, or psychological issues.
   - Always prioritize the user's well-being and spiritual growth.

9. Tone and Style:
    - Use spiritual terminology (e.g., dharma, karma, moksha) with explanations for clarity.
    - Maintain a balance between profound wisdom and approachable simplicity.`;

        function createMessageElement(text, alignment) {
            const messageElement = document.createElement("div");
            messageElement.className = `inline-block max-w-[80%] p-3 rounded-lg ${
                alignment === "left" ? "bg-purple-100 text-black self-start" : "bg-blue-100 text-black self-end"
            }`;
            messageElement.textContent = text;
            return messageElement;
        }

        function connectWebSocket(message) {
            receiving = true;
            const url = "wss://backend.buildpicoapps.com/api/chatbot/chat";
            const websocket = new WebSocket(url);

            websocket.addEventListener("open", () => {
                websocket.send(
                    JSON.stringify({
                        chatId: chatId,
                        appId: "heart-rich",
                        systemPrompt: systemPrompt,
                        message: message,
                    })
                );
            });

            const messageElement = createMessageElement("", "left");
            chatbox.appendChild(messageElement);

            websocket.onmessage = (event) => {
                messageElement.textContent += event.data;
                chatbox.scrollTop = chatbox.scrollHeight;
            };

            websocket.onclose = (event) => {
                if (event.code === 1000) {
                    receiving = false;
                } else {
                    messageElement.textContent += " Error getting response from server. Refresh the page and try again.";
                    chatbox.scrollTop = chatbox.scrollHeight;
                    receiving = false;
                }
            };

            websocket.onerror = () => {
                messageElement.textContent += " Connection error. Please try again.";
                chatbox.scrollTop = chatbox.scrollHeight;
                receiving = false;
            };
        }

        sendButton.addEventListener("click", () => {
            if (!receiving && messageInput.value.trim() !== "") {
                const messageText = messageInput.value.trim();
                messageInput.value = "";
                const messageElement = createMessageElement(messageText, "right");
                chatbox.appendChild(messageElement);
                chatbox.scrollTop = chatbox.scrollHeight;

                connectWebSocket(messageText);
            }
        });

        messageInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter" && !receiving && messageInput.value.trim() !== "") {
                event.preventDefault();
                sendButton.click();
            }
        });

        function welcomeMessageFirstTime() {
            const welcomeMessage = "Om Shanti, dear seeker! What enlightenment do you seek today?";
            const messageElement = createMessageElement(welcomeMessage, "left");
            chatbox.appendChild(messageElement);
        }

        welcomeMessageFirstTime();
    </script>
</body>
</html>
